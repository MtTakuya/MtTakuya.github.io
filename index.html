<!doctype html>
<html lang="ja" class="h-full scroll-smooth">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>億プレーヤー化ダッシュボード｜Mobile Polished</title>

<!-- Tailwind (Play CDN) -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        colors: {
          ink: { DEFAULT: '#0f172a' },
          pane: { DEFAULT: '#0f172a' },
          line: { DEFAULT: '#1f2a44' },
          accent: { DEFAULT: '#38bdf8' },
          accent2: { DEFAULT: '#a78bfa' },
        },
        boxShadow: {
          soft: '0 10px 30px rgba(2,6,23,.18), 0 4px 10px rgba(2,6,23,.10)',
          softDark: '0 10px 30px rgba(2,6,23,.35), 0 4px 10px rgba(2,6,23,.25)',
        },
        borderRadius: { xl2: '1.25rem' }
      }
    }
  }
</script>

<!-- Alpine.js + persist plugin（状態保存） -->
<script defer src="https://unpkg.com/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<style>
/* 背景グラデ＋iOSセーフエリア余白 */
.bg-grid {
  background:
    radial-gradient(1200px 900px at 10% -10%, rgba(59,130,246,.10), transparent),
    radial-gradient(1000px 700px at 115% 20%, rgba(168,85,247,.10), transparent);
}
@media (prefers-color-scheme: dark){
  .bg-grid { background-color: #0b0f1a; }
}
@media (prefers-color-scheme: light){
  .bg-grid { background-color: #f7f8fb; }
}
.safe-bottom { padding-bottom: max(env(safe-area-inset-bottom), 16px); }
.safe-top { padding-top: max(env(safe-area-inset-top), 8px); }
</style>
</head>

<body class="h-full antialiased bg-grid" x-data="app()" x-init="init()" :class="dark ? 'dark text-slate-100' : 'text-ink'">
  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur-md border-b border-white/10 bg-white/60 dark:bg-slate-900/50 safe-top">
    <div class="max-w-screen-md mx-auto px-4 py-3 flex items-center gap-3 justify-between">
      <div class="flex items-center gap-3 min-w-0">
        <div class="w-8 h-8 rounded-xl border border-white/20 shadow-softDark dark:shadow-soft"
             style="background: conic-gradient(from 180deg, #38bdf8, #a78bfa)"></div>
        <div class="font-extrabold text-base sm:text-lg truncate">億プレーヤー化ダッシュボード
          <span class="text-xs font-semibold opacity-70">— 2026年11月ピーク</span>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button @click="toggleDark()" class="h-10 w-10 grid place-items-center rounded-xl border border-white/20 bg-white/70 dark:bg-slate-800/80 shadow-softDark">
          <span x-text="dark ? '🌙' : '🌞'"></span>
        </button>
        <button @click="openSheet()" class="px-3 h-10 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-bold shadow-softDark">✎ 編集</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-screen-md mx-auto px-4 pb-28 pt-4 space-y-4">
    <!-- KPI -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark p-4">
      <h3 class="font-bold text-lg mb-2">KPI（タップで更新）</h3>
      <div class="space-y-3">
        <!-- 体重 -->
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="flex items-end gap-2 leading-none">
              <span class="text-3xl font-extrabold" x-text="fmt1(kpi.wt)"></span>
              <span class="text-slate-500 dark:text-slate-400 font-bold">kg</span>
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-400">現在体重（目標 <span x-text="Math.round(kpi.wtTarget)"></span>kg）</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('wt', -0.1)">−</button>
            <input type="number" step="0.1" inputmode="decimal" class="h-11 w-24 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3 text-right"
                   :value="kpi.wt" @change="setNum('wt', $event.target.value)">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('wt', +0.1)">＋</button>
          </div>
        </div>
        <!-- 睡眠 -->
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="flex items-end gap-2 leading-none">
              <span class="text-3xl font-extrabold" x-text="kpi.sleep.toFixed(1)"></span>
              <span class="text-slate-500 dark:text-slate-400 font-bold">h</span>
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-400">平均睡眠（下限 <span x-text="kpi.sleepMin.toFixed(1)"></span>h）</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('sleep', -0.1)">−</button>
            <input type="number" step="0.1" inputmode="decimal" class="h-11 w-24 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3 text-right"
                   :value="kpi.sleep" @change="setNum('sleep', $event.target.value)">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('sleep', +0.1)">＋</button>
          </div>
        </div>
        <!-- 水分 -->
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="flex items-end gap-2 leading-none">
              <span class="text-3xl font-extrabold" x-text="kpi.water.toFixed(1)"></span>
              <span class="text-slate-500 dark:text-slate-400 font-bold">L</span>
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-400">水分（合宿時 <span x-text="kpi.waterCamp.toFixed(1)"></span>L）</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('water', -0.1)">−</button>
            <input type="number" step="0.1" inputmode="decimal" class="h-11 w-24 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3 text-right"
                   :value="kpi.water" @change="setNum('water', $event.target.value)">
            <button class="h-11 w-11 rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 font-extrabold text-lg"
                    @click="adj('water', +0.1)">＋</button>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mt-3">
        <span class="px-3 py-1.5 rounded-full border border-white/20 text-sm text-slate-600 dark:text-slate-300">風呂掃除＋食器洗い</span>
        <span class="px-3 py-1.5 rounded-full border border-white/20 text-sm text-slate-600 dark:text-slate-300">ジム：A/B/C/D</span>
        <span class="px-3 py-1.5 rounded-full border border-white/20 text-sm text-slate-600 dark:text-slate-300">知識スライド1枚→Anki5分</span>
      </div>
    </section>

    <!-- ロードマップ（アコーディオン） -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="{open:true}">
      <button class="w-full px-4 py-3 flex items-center justify-between" @click="open=!open">
        <h3 class="font-bold text-lg">ロードマップ（2025/10→2026/11）</h3>
        <div class="w-7 h-7 grid place-items-center rounded-lg border border-white/20"
             :class="open ? 'rotate-180' : ''">⌄</div>
      </button>
      <div x-show="open" x-collapse>
        <div class="px-4 pb-4 space-y-3">
          <div class="space-y-2">
            <div class="flex items-center gap-2 border-l-4 border-white/20 pl-3">
              <div class="w-2 h-2 rounded-full bg-accent"></div>
              <div class="font-semibold">A：土台（〜2026/01）</div>
              <div class="ml-auto text-xs text-slate-500 dark:text-slate-400">睡眠/水分/家事/依存/基礎体力</div>
            </div>
            <div class="flex items-center gap-2 border-l-4 border-white/20 pl-3">
              <div class="w-2 h-2 rounded-full bg-accent"></div>
              <div class="font-semibold">B：小さく稼ぐ（〜2026/05）</div>
              <div class="ml-auto text-xs text-slate-500 dark:text-slate-400">Bβ/C MVP/PC/会議運用</div>
            </div>
            <div class="flex items-center gap-2 border-l-4 border-white/20 pl-3">
              <div class="w-2 h-2 rounded-full bg-accent"></div>
              <div class="font-semibold">C：継続収入化（〜2026/09）</div>
              <div class="ml-auto text-xs text-slate-500 dark:text-slate-400">3–10万/月・76kg台</div>
            </div>
            <div class="flex items-center gap-2 border-l-4 border-white/20 pl-3">
              <div class="w-2 h-2 rounded-full bg-accent"></div>
              <div class="font-semibold">D：仕上げ（〜2026/11）</div>
              <div class="ml-auto text-xs text-slate-500 dark:text-slate-400">疲労管理/発信/ピーク</div>
            </div>
          </div>
          <div class="grid sm:grid-cols-2 gap-3">
            <div class="border border-white/20 rounded-xl p-3"> <b>土曜</b>：10–12(〜13) ラグビー → 補強 / 3連休＝合宿 </div>
            <div class="border border-white/20 rounded-xl p-3"> <b>平日</b>：9–17:30勤務 → 家事 → 週4ジム/週2スプリント → 学習45分 → 23:30就寝 </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 4本柱 -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="{open:true}">
      <button class="w-full px-4 py-3 flex items-center justify-between" @click="open=!open">
        <h3 class="font-bold text-lg">4本柱（中核オペ）</h3>
        <div class="w-7 h-7 grid place-items-center rounded-lg border border-white/20"
             :class="open ? 'rotate-180' : ''">⌄</div>
      </button>
      <div x-show="open" x-collapse>
        <div class="px-4 pb-4 grid sm:grid-cols-2 gap-3">
          <div class="border border-white/20 rounded-xl p-3"><b>基盤</b><ul class="list-none pl-0 space-y-1 mt-1 text-sm opacity-90"><li>睡眠7h / 水2.5L / 家事（風呂＋食器）＋ローテ1つ</li></ul></div>
          <div class="border border-white/20 rounded-xl p-3"><b>競技エンジン</b><ul class="space-y-1 mt-1 text-sm opacity-90"><li>週4ジム（A下重 / B上 / C補強 / D下中＋腹）＋週2スプリント</li></ul></div>
          <div class="border border-white/20 rounded-xl p-3"><b>スキル・知識</b><ul class="space-y-1 mt-1 text-sm opacity-90"><li>技術45分/日（Git・Python・LLM・配布・課金）</li><li>知識15分×3（1日1枚→Anki）</li></ul></div>
          <div class="border border-white/20 rounded-xl p-3"><b>レバレッジ</b><ul class="space-y-1 mt-1 text-sm opacity-90"><li>B：会議要約→β課金</li><li>C：YouTube集中支援ツール</li></ul></div>
        </div>
      </div>
    </section>

    <!-- 週間計画（タブ） -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="tabs('mon')">
      <div class="px-4 pt-4">
        <h3 class="font-bold text-lg">週間計画（固定ルーティン）</h3>
        <div class="mt-3 inline-flex rounded-xl border border-white/20 p-1 bg-white/60 dark:bg-slate-800/60">
          <button :class="btn('mon')" @click="set('mon')">月〜金</button>
          <button :class="btn('sat')" @click="set('sat')">土曜</button>
          <button :class="btn('sun')" @click="set('sun')">日曜</button>
        </div>
      </div>
      <div class="p-4 pt-3">
        <template x-if="current==='mon'">
          <div class="space-y-2" id="todo-weekday"></div>
        </template>
        <template x-if="current==='sat'">
          <div class="space-y-2" id="todo-sat"></div>
        </template>
        <template x-if="current==='sun'">
          <div class="space-y-2" id="todo-sun"></div>
        </template>
      </div>
    </section>

    <!-- トレーニング -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="{open:true}">
      <button class="w-full px-4 py-3 flex items-center justify-between" @click="open=!open">
        <h3 class="font-bold text-lg">ジム & スプリント（週4＋週2）</h3>
        <div class="w-7 h-7 grid place-items-center rounded-lg border border-white/20"
             :class="open ? 'rotate-180' : ''">⌄</div>
      </button>
      <div x-show="open" x-collapse>
        <div class="px-4 pb-4 grid sm:grid-cols-2 gap-3 text-sm">
          <div class="space-y-3">
            <div class="border border-white/20 rounded-xl p-3"><b>A：下半身重</b><ul class="list-none space-y-1 mt-1"><li>SQ 6–8×3 / RDL 6–8×3 / ランジ / カーフ</li><li>体幹：ローラー 8–12×3 → 立ちコロ補助</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>B：上半身プレス</b><ul class="space-y-1 mt-1"><li>BP / ショルダープレス / ディップス</li><li>首アイソ（週2）</li></ul></div>
          </div>
          <div class="space-y-3">
            <div class="border border-white/20 rounded-xl p-3"><b>C：スプリント補強</b><ul class="space-y-1 mt-1"><li>プライオ・回旋・臀部＋ロー/懸垂</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>D：下半身中＋腹</b><ul class="space-y-1 mt-1"><li>片脚系・ヒンジ / ローラー・プランク</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>スプリント</b><ul class="space-y-1 mt-1"><li>10m/30m/60m × 各3（完全レスト） × 週2</li></ul></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 知識 -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="tabs('hist')">
      <div class="px-4 pt-4">
        <h3 class="font-bold text-lg">知識カリキュラム（毎日15分×3）</h3>
        <div class="mt-3 inline-flex rounded-xl border border-white/20 p-1 bg-white/60 dark:bg-slate-800/60">
          <button :class="btn('hist')" @click="set('hist')">歴史/政治/経済</button>
          <button :class="btn('sports')" @click="set('sports')">スポーツ/車/ファッション</button>
          <button :class="btn('life')" @click="set('life')">酒/家とお金/旅行・会話</button>
        </div>
      </div>
      <div class="p-4 pt-3 text-sm">
        <template x-if="current==='hist'">
          <div class="grid sm:grid-cols-3 gap-3">
            <div class="border border-white/20 rounded-xl p-3"><b>歴史</b><ul class="space-y-1 mt-1"><li>出来事→因→果→長期影響</li><li>産業革命→都市化→労働法→選挙制度</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>政治・制度</b><ul class="space-y-1 mt-1"><li>三権分立 / 選挙 / 地方自治</li><li>税・社会保障の流れ</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>経済・投資</b><ul class="space-y-1 mt-1"><li>金利・インフレ・為替</li><li>指数投資・複利・リバランス / FCF</li></ul></div>
          </div>
        </template>
        <template x-if="current==='sports'">
          <div class="grid sm:grid-cols-3 gap-3">
            <div class="border border-white/20 rounded-xl p-3"><b>スポーツ</b><ul class="space-y-1 mt-1"><li>花園＝東大阪市花園ラグビー場</li><li>反則・逆転パターンの言語化</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>車</b><ul class="space-y-1 mt-1"><li>主要メーカー</li><li>ボディ型×価格帯→街で即答練習</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>ファッション</b><ul class="space-y-1 mt-1"><li>渋クラ：ヘリテージ×ミニマル</li><li>再現コーデ週1 / Pinterest週10ピン</li></ul></div>
          </div>
        </template>
        <template x-if="current==='life'">
          <div class="grid sm:grid-cols-3 gap-3">
            <div class="border border-white/20 rounded-xl p-3"><b>酒</b><ul class="space-y-1 mt-1"><li>ビール/ウイスキー/日本酒の製法</li><li>代表銘柄×テイスティング語彙10</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>家とお金</b><ul class="space-y-1 mt-1"><li>固定/変動費の可視化</li><li>口座/クレカ最適化</li></ul></div>
            <div class="border border-white/20 rounded-xl p-3"><b>旅行・会話</b><ul class="space-y-1 mt-1"><li>持ち物テンプレ / 当日動線</li><li>事実→感情→要望 / 要約→感謝</li></ul></div>
          </div>
        </template>
      </div>
    </section>

    <!-- 生活 & 週次 -->
    <section class="rounded-xl2 border border-white/10 bg-white/60 dark:bg-slate-900/60 shadow-softDark"
             x-data="{open:true}">
      <button class="w-full px-4 py-3 flex items-center justify-between" @click="open=!open">
        <h3 class="font-bold text-lg">家事 & 依存対策 / 週次レビュー</h3>
        <div class="w-7 h-7 grid place-items-center rounded-lg border border-white/20"
             :class="open ? 'rotate-180' : ''">⌄</div>
      </button>
      <div x-show="open" x-collapse>
        <div class="px-4 pb-4 grid sm:grid-cols-2 gap-3 text-sm">
          <div class="border border-white/20 rounded-xl p-3">
            <b>家事（デフォ毎日）</b>
            <ul class="space-y-1 mt-1">
              <li>風呂掃除 / 食器洗い（必須）</li>
              <li>＋ローテ1つ：月ゴミ/火床/水洗濯/木キッチン/金買い出し/土部屋/日作り置き</li>
            </ul>
          </div>
          <div class="border border-white/20 rounded-xl p-3">
            <b>依存対策</b>
            <ul class="space-y-1 mt-1">
              <li>スマホ寝室外 / ベッドでスマホ禁止</li>
              <li>SNS/YouTube：昼15分＋夜30分（タイマー）</li>
              <li>置換30秒：水→スクワット10→アプリ終了→机</li>
            </ul>
          </div>
          <div class="border border-white/20 rounded-xl p-3 sm:col-span-2">
            <b>KPI & 週次レビュー（自動ToDo）</b>
            <div class="mt-2 space-y-2" id="todo-weekly"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom bar -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 safe-bottom">
    <div class="mx-auto max-w-screen-md px-4">
      <div class="rounded-2xl border border-white/10 backdrop-blur-md bg-white/70 dark:bg-slate-900/70 shadow-softDark">
        <div class="grid grid-cols-3 gap-2 p-2">
          <button class="h-12 rounded-xl border border-white/20 bg-white/90 dark:bg-slate-800/80 font-bold" @click="toast('ジム、いこう💪（終わったらチェック）')">🏋️ ジム</button>
          <button class="h-12 rounded-xl border border-white/20 bg-white/90 dark:bg-slate-800/80 font-bold" @click="toast('学習45分、スタート📚')">📚 学習</button>
          <button class="h-12 rounded-xl border border-white/20 bg-white/90 dark:bg-slate-800/80 font-bold" @click="toast('家事達成、お疲れ！🧽')">🧽 家事</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- FAB -->
  <button class="fixed right-4 bottom-24 z-50 w-14 h-14 rounded-2xl border border-white/20 shadow-softDark text-black font-extrabold text-2xl"
          style="background: linear-gradient(135deg, #38bdf8, #a78bfa)" @click="openSheet()">＋</button>

  <!-- KPI 編集：ボトムシート -->
  <div x-show="sheet" x-transition.opacity class="fixed inset-0 z-50 bg-black/40" @click.self="sheet=false">
    <div x-show="sheet" x-transition
         class="absolute left-0 right-0 bottom-0 mx-auto w-full max-w-screen-md bg-white dark:bg-slate-900 rounded-t-2xl border border-white/10 shadow-softDark p-4">
      <div class="flex items-center justify-between">
        <h3 class="font-bold text-lg">KPI編集</h3>
        <button class="h-10 w-10 rounded-xl border border-white/20" @click="sheet=false">✖</button>
      </div>
      <div class="grid sm:grid-cols-2 gap-3 mt-3">
        <div class="border border-white/20 rounded-xl p-3">
          <b>体重</b>
          <label class="block text-sm mt-2 opacity-70">現在</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.wt" @change="setNum('wt', $event.target.value)">
          <label class="block text-sm mt-3 opacity-70">目標</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.wtTarget" @change="setNum('wtTarget', $event.target.value)">
        </div>
        <div class="border border-white/20 rounded-xl p-3">
          <b>睡眠</b>
          <label class="block text-sm mt-2 opacity-70">平均(h)</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.sleep" @change="setNum('sleep', $event.target.value)">
          <label class="block text-sm mt-3 opacity-70">下限(h)</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.sleepMin" @change="setNum('sleepMin', $event.target.value)">
        </div>
        <div class="border border-white/20 rounded-xl p-3">
          <b>水分</b>
          <label class="block text-sm mt-2 opacity-70">現在(L)</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.water" @change="setNum('water', $event.target.value)">
          <label class="block text-sm mt-3 opacity-70">合宿(L)</label>
          <input type="number" step="0.1" inputmode="decimal" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.waterCamp" @change="setNum('waterCamp', $event.target.value)">
        </div>
        <div class="border border-white/20 rounded-xl p-3">
          <b>頻度設定</b>
          <label class="block text-sm mt-2 opacity-70">週のジム</label>
          <input type="number" step="1" inputmode="numeric" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.gymPerWeek" @change="setNum('gymPerWeek', $event.target.value)">
          <label class="block text-sm mt-3 opacity-70">スプリント/週</label>
          <input type="number" step="1" inputmode="numeric" class="mt-1 h-11 w-full rounded-xl border border-white/20 bg-white/80 dark:bg-slate-800/80 px-3"
                 :value="kpi.sprintPerWeek" @change="setNum('sprintPerWeek', $event.target.value)">
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button class="px-4 h-11 rounded-xl border border-white/20" @click="resetChecks()">チェックのみリセット</button>
        <button class="px-4 h-11 rounded-xl border border-white/20 bg-accent/80 text-black font-extrabold" @click="sheet=false">保存</button>
      </div>
    </div>
  </div>

  <!-- JS（Alpineコンポーネント） -->
  <script>
    function tabs(initial){
      return {
        current: initial,
        set(id){ this.current = id },
        btn(id){
          return [
            'px-4 h-10 rounded-lg font-semibold',
            'border',
            this.current===id ? 'bg-accent/20 border-accent text-slate-900 dark:text-slate-100' : 'bg-transparent border-white/20 text-slate-600 dark:text-slate-300'
          ].join(' ')
        }
      }
    }

    function app(){
      return {
        // ---- 状態（保存） ----
        dark: Alpine.$persist(window.matchMedia('(prefers-color-scheme: dark)').matches).as('oku_theme_dark'),
        sheet: false,
        kpi: Alpine.$persist({
          wt: 71, wtTarget: 77,
          sleep: 7.0, sleepMin: 7.0,
          water: 2.5, waterCamp: 3.0,
          gymPerWeek: 4, sprintPerWeek: 2
        }).as('oku_kpi_v4'),

        init(){
          // チェックリスト初期化
          this.bindChecklist('todo-weekday','chk_weekday',[
            '06:30 起床→水→日光→知識ノート15分',
            '出勤前：荷物チェック（PC/ボトル/プロテイン）',
            '12:30 散歩10分＋SNS 15分まで',
            '帰宅後：風呂掃除＋食器洗い（必須）',
            `ジム or スプリント（週${this.kpi.gymPerWeek}/${this.kpi.sprintPerWeek}）`,
            '風呂→栄養→学習45分（技術/知識）',
            '23:00 ストレッチ / スマホ別室充電→23:30就寝（7h）'
          ]);
          this.bindChecklist('todo-sat','chk_sat',[
            '10:00–12:00 ラグビー（〜13:00の場合あり）',
            '補給：糖＋WPI / ストレッチ',
            '補強（下半身/体幹）',
            '部屋リセット60分',
            '作り置き1品'
          ]);
          this.bindChecklist('todo-sun','chk_sun',[
            '回復：軽い有酸素 or モビリティ',
            '週次レビュー20分（KPI・予定更新）',
            'デート/家族の時間',
            '作り置き2品'
          ]);
          this.bindChecklist('todo-weekly','chk_weekly', this.weeklyItems());
        },

        // ---- 見た目・操作 ----
        toggleDark(){ this.dark = !this.dark },
        openSheet(){ this.sheet = true },
        toast(msg){ alert(msg) },

        // ---- KPI操作 ----
        fmt1(x){ return Number(x).toFixed(1).replace(/\.0$/,'') },
        setNum(key, val){
          const v = parseFloat(val);
          if(!isNaN(v)){ this.kpi[key] = v }
          // 平日の文言を最新頻度に差し替え
          this.bindChecklist('todo-weekday','chk_weekday',[
            '06:30 起床→水→日光→知識ノート15分',
            '出勤前：荷物チェック（PC/ボトル/プロテイン）',
            '12:30 散歩10分＋SNS 15分まで',
            '帰宅後：風呂掃除＋食器洗い（必須）',
            `ジム or スプリント（週${this.kpi.gymPerWeek}/${this.kpi.sprintPerWeek}）`,
            '風呂→栄養→学習45分（技術/知識）',
            '23:00 ストレッチ / スマホ別室充電→23:30就寝（7h）'
          ]);
        },
        adj(key, delta){
          const clamp = (n,min,max)=> Math.max(min, Math.min(max,n));
          const map = {
            wt: [40,150], sleep:[0,16], water:[0,10]
          };
          const [mn,mx] = map[key];
          this.kpi[key] = clamp((+this.kpi[key] + delta), mn, mx);
        },

        // ---- チェックリスト ----
        weeklyItems(){
          return [
            'KPI入力：体重・睡眠平均・水分・スプリントTT',
            '副業：B改善×2 / Cリリース×1',
            '知識：1日1枚×7→金土クイズ10問',
            '家事：デフォ毎日＋ローテ達成80%+',
            '依存対策：○×カレンダー更新',
            '次週の3タスク決定（最大3つ）'
          ]
        },
        bindChecklist(container,key,items){
          const box = document.getElementById(container);
          const state = JSON.parse(localStorage.getItem(key)||'{}');
          box.innerHTML='';
          items.forEach((t,i)=>{
            const id = `${key}_${i}`;
            const wrap = document.createElement('label');
            wrap.className = "flex items-start gap-3 border border-white/20 rounded-xl p-3 bg-white/60 dark:bg-slate-900/60";
            const cb = document.createElement('input');
            cb.type='checkbox';
            cb.checked=!!state[id];
            cb.className="mt-1 h-5 w-5 accent-cyan-400";
            cb.addEventListener('change',()=>{ state[id]=cb.checked; localStorage.setItem(key, JSON.stringify(state)); });
            const span = document.createElement('span'); span.textContent = t; span.className="flex-1";
            wrap.appendChild(cb); wrap.appendChild(span); box.appendChild(wrap);
          });
        },
        resetChecks(){
          ['chk_weekday','chk_sat','chk_sun','chk_weekly'].forEach(k=> localStorage.removeItem(k));
          this.bindChecklist('todo-weekly','chk_weekly', this.weeklyItems());
          this.toast('チェック状態をリセットしました');
        }
      }
    }
  </script>
</body>
</html>
